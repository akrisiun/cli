<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>netcoreapp3.0</TargetFramework>
    <OutputType>Exe</OutputType>
    <MicrosoftBuildPackageVersion>16.0.452</MicrosoftBuildPackageVersion>

    <Version>1.1.0</Version>
    <minus>-</minus>
    <LibDir>c:\bin\dotb</LibDir>
    <!-- -->
    <!--<DotNetDir>$(USERPROFILE)/.dotnet/x64/</DotNetDir>-->
    <DotNetDir>E:\Beta\dot64\dotnet-cli\.dotnet\</DotNetDir>

    <PackageRequireLicenseAcceptance>false</PackageRequireLicenseAcceptance>
    <FindDependenciesOfExternallyResolvedReferences>true</FindDependenciesOfExternallyResolvedReferences>
    <DisableWarnForInvalidRestoreProjects>true</DisableWarnForInvalidRestoreProjects>
  </PropertyGroup>

  <PropertyGroup>
    <TreatWarningsAsErrors>false</TreatWarningsAsErrors>
    <WarningsAsErrors />
    <DefineConstants>TRACE;DEBUG</DefineConstants>
    <NewtonsoftVersion>10.0.3</NewtonsoftVersion>
  </PropertyGroup>

  <ItemGroup>
    <!--<NewtonsoftVersion>9.0.1</NewtonsoftVersion>-->
    <PackageReference Include="Newtonsoft.Json" Version="$(NewtonsoftVersion)" />
    <!-- 
    <PackageReference Include="Microsoft.Build.Runtime" Version="$(MicrosoftBuildPackageVersion)" />
    -->
    <!--<PackageReference Include="Microsoft.Build" Version="$(MicrosoftBuildPackageVersion)" />
    <PackageReference Include="Microsoft.Build.Tasks.Core" Version="$(MicrosoftBuildPackageVersion)" />
    <PackageReference Include="Microsoft.Build.Utilities.Core" Version="$(MicrosoftBuildPackageVersion)" />
	-->
    <!--<PackageReference Include="Microsoft.Build.Framework" Version="$(MicrosoftBuildPackageVersion)" />-->
    <!--<ProjectReference Include="..\msbuild\src\MSBuild\MSBuild.csproj" />-->
  </ItemGroup>

  <ItemGroup>
    <Reference Include="MSBuild, Version=42.42.42.42, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a">
      <HintPath>..\lib\MSBuild.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Build">
      <HintPath>..\lib\Microsoft.Build.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Build.Framework, Version=42.42.42.42, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a">
      <HintPath>..\lib\Microsoft.Build.Framework.dll</HintPath>
    </Reference>
    <!--       Version=15.1.0.455, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
    -->
    <Reference Include="Newtonsoft.Json">
      <HintPath>..\nuget\Newtonsoft.Json.dll</HintPath>
    </Reference>
    <Reference Include="NuGet.Build.Tasks">
      <HintPath>..\nuget\NuGet.Build.Tasks.dll</HintPath>
    </Reference>
    <Reference Include="NuGet.CommandLine.XPlat">
      <HintPath>..\nuget\NuGet.CommandLine.XPlat.dll</HintPath>
    </Reference>
    <Reference Include="NuGet.Commands">
      <HintPath>..\nuget\NuGet.Commands.dll</HintPath>
    </Reference>
    <Reference Include="NuGet.Common">
      <HintPath>..\nuget\NuGet.Common.dll</HintPath>
    </Reference>
    <Reference Include="NuGet.Configuration">
      <HintPath>..\nuget\NuGet.Configuration.dll</HintPath>
    </Reference>
    <Reference Include="NuGet.Credentials">
      <HintPath>..\nuget\NuGet.Credentials.dll</HintPath>
    </Reference>
    <Reference Include="NuGet.DependencyResolver.Core">
      <HintPath>..\nuget\NuGet.DependencyResolver.Core.dll</HintPath>
    </Reference>
    <!--<Reference Include="NuGet.Frameworks">
      <HintPath>..\nuget\NuGet.Frameworks.dll</HintPath>
      <Private>true</Private>
    </Reference>-->
    <!-- NuGet.Frameworks preview1.5663 
    https://dotnet.myget.org/feed/nuget-build/package/nuget/NuGet.Commands
    5.1.0-rtm.5864
    <PackageReference Include="NuGet.Frameworks" Version="5.0.0-rtm.5821" />
    -->
    <PackageReference Include="NuGet.Frameworks" Version="5.0.0-preview1.5663" />
    <PackageReference Include="NuGet.Build.Tasks" Version="5.0.0-preview1.5663" />
    <PackageReference Include="NuGet.Commands" Version="5.0.0-preview1.5663" />
    
    <Reference Include="NuGet.LibraryModel">
      <HintPath>..\nuget\NuGet.LibraryModel.dll</HintPath>
    </Reference>
    <Reference Include="NuGet.Packaging">
      <HintPath>..\nuget\NuGet.Packaging.dll</HintPath>
    </Reference>
    <Reference Include="NuGet.Packaging.Core">
      <HintPath>..\nuget\NuGet.Packaging.Core.dll</HintPath>
    </Reference>
    <Reference Include="NuGet.ProjectModel">
      <HintPath>..\nuget\NuGet.ProjectModel.dll</HintPath>
    </Reference>
    <Reference Include="NuGet.Protocol">
      <HintPath>..\nuget\NuGet.Protocol.dll</HintPath>
    </Reference>
    <Reference Include="NuGet.Versioning">
      <HintPath>..\nuget\NuGet.Versioning.dll</HintPath>
    </Reference>
  </ItemGroup>
  <Target Name="PostBuildTask" AfterTargets="Build">
    <Message Condition="Exists($(LibDir))" Importance="High" Text="| src\dotnet\dotnet.csproj | copy to $(LibDir)\$(TargetName).dll" />
    <Message Condition="!Exists($(LibDir))" Importance="High" Text="NO $(LibDir)" />
    
    <Exec Condition="'$(MSBuildRuntimeType)' == 'Full'" Command="$(DotNetDir)dotnet.exe build $(SourceDir) -o $(LibDir) -c Debug --no-restore" />
    <!--

    -->
    <Exec Condition="'$(MSBuildRuntimeType)' == 'Full'" Command="$(DotNetDir)dotnet.exe build ..\..\vendor\msbuild\src\MSBuild\MSBuild.csproj -f netcoreapp3.0 -o $(LibDir) -c Debug --no-restore" />
          
    
    <Copy Condition="Exists($(LibDir))" SourceFiles="$(TargetDir)$(TargetName).dll" DestinationFiles="$(LibDir)\$(TargetName).dll" SkipUnchangedFiles="false" />
  </Target>

</Project>
